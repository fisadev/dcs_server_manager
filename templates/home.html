<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCS Server Manager</title>
    <link rel="icon" href="{{ url_for('static', filename='icon.png') }}">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='htmx_2.0.4.min.js') }}"></script>
</head>
<body>
    <div class="sidebar">
        <img class="main-logo" src="{{ url_for('static', filename='icon.png') }}" alt="Icon">
        <h1>DCS Server Manager</h1>
        <button class="nav-link" data-target="dcs-section" onclick="showSection('dcs-section')">
            DCS <span id="dcs-status-icon" hx-get="/dcs/status/icon" hx-trigger="load, every 5s"/>
        </button>
        <button class="nav-link" data-target="srs-section" onclick="showSection('srs-section')">
            SRS <span id="srs-status-icon" hx-get="/srs/status/icon" hx-trigger="load, every 5s"/>
        </button>
        <button class="nav-link" data-target="logs-section" onclick="showSection('logs-section')">Logs</button>
    </div>

    <div class="main-content">
        <div class="section" id="dcs-section">
            <div class="section-content">
                <h2>DCS Server:
                    <span id="dcs-status" hx-get="/dcs/status" hx-trigger="load, every 5s">
                        Loading status...
                    </span> 
                </h2>
                <div id="dcs-resources" hx-get="/dcs/resources" hx-trigger="load, every 5s">
                    Loading resources usage...
                </div>
                <div id="dcs-mission-status" hx-get="/dcs/mission_status" hx-trigger="load, every 5s">
                    Loading mission status...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-post="/dcs/start" hx-target="#dcs-status">Start</button>
                    <button class="btn-normal" hx-post="/dcs/restart" hx-target="#dcs-status">Restart</button>
                    <button class="btn-red" hx-post="/dcs/kill" hx-target="#dcs-status">Kill</button>
                </div>

                <div class="foldable-section">
                    <h3 class="foldable-title" onclick="toggleFoldable(this)">
                        <span class="icon">▼</span>
                        Manager settings
                    </h3>
                    <div class="foldable-content">
                        <div id="dcs-manager-config" hx-get="/dcs/manager_config_form" hx-trigger="load">
                            Loading config...
                        </div>
                        <div class="button-group">
                            <button class="btn-normal" hx-post="/dcs/manager_config_form" hx-target="#dcs-manager-config" hx-include="#dcs-manager-config-form">
                                Save and apply
                            </button>
                            <button class="btn-normal" hx-get="/dcs/manager_config_form" hx-target="#dcs-manager-config">
                                Undo unsaved changes
                            </button>
                        </div>
                        <h3>Hook me to the DCS Server</h3>
                        <p>
                            The hook is a lua script that runs inside the DCS Server, and gets the current mission and player list, 
                            to then be able to show it in the status section right above. Installing it isn't required, but it is 
                            quite useful and easy to do (just click the button and restart the server).
                        </p>
                        <div id="dcs-hook-action-result"></div>
                        <div class="button-group">
                            <button class="btn-normal" hx-post="/dcs/hook/install" hx-target="#dcs-hook-action-result">
                                Install/update hook
                            </button>
                            <button class="btn-normal" hx-post="/dcs/hook/uninstall" hx-target="#dcs-hook-action-result">
                                Uninstall hook
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-content">
                <h2>DCS Server Configuration</h2>
                <div id="dcs-config" hx-get="/dcs/config_form" hx-trigger="load">
                    Loading config...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-post="/dcs/config_form" hx-target="#dcs-config" hx-include="#dcs-config-form">
                        Save
                    </button>
                    <button class="btn-normal" hx-post="/dcs/config_form/restart" hx-target="#dcs-config" hx-include="#dcs-config-form">
                        Save and restart DCS Server
                    </button>
                    <button class="btn-normal" hx-get="/dcs/config_form" hx-target="#dcs-config">
                        Undo unsaved changes
                    </button>
                </div>
            </div>

            <div class="section-content">
                <h2>Mission Files</h2>
                <div id="dcs-missions" hx-get="/dcs/missions" hx-trigger="load">
                    Loading missions...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-get="/dcs/missions" hx-target="#dcs-missions">Refresh</button>
                    <button class="btn-normal" hx-post="/dcs/missions" hx-target="#dcs-missions" hx-include="#mission-upload-form" hx-encoding="multipart/form-data" hx-indicator="#mission-upload-working">
                        Upload mission file:
                    </button>
                    <form id="mission-upload-form" method=post>
                        <input type="file" name="mission_file">
                    </form>
                </div>
                <div id="mission-upload-working" class="working">
                    <p>
                        <img class="spinner" src="{{ url_for('static', filename='spinner.gif') }}" />
                        Uploading mission...
                    </p>
                </div>
            </div>

            <div class="section-content">
                <h2>Track Files</h2>
                <div id="dcs-tracks" hx-get="/dcs/tracks" hx-trigger="load">
                    Loading track files...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-get="/dcs/tracks" hx-target="#dcs-tracks">Refresh</button>
                    <button class="btn-red">Delete all</button>
                </div>
            </div>

            <div class="section-content">
                <h2>Tacview Files</h2>
                <div id="dcs-tacviews" hx-get="/dcs/tacviews" hx-trigger="load">
                    Loading Tacview replay files...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-get="/dcs/tacviews" hx-target="#dcs-tacviews">Refresh</button>
                    <button class="btn-red">Delete all</button>
                </div>
            </div>

            <div class="section-content">
                <h2>Other utilities</h2>
                <div class="button-group">
                    <button class="btn-normal">Enable Pretense persistence</button>
                </div>
            </div>
        </div>

        <div class="section" id="srs-section">
            <div class="section-content">
                <h2>SRS Server:
                    <span id="srs-status" hx-get="/srs/status" hx-trigger="load, every 5s">
                        Loading status...
                    </span>
                </h2>
                <div id="srs-resources" hx-get="/srs/resources" hx-trigger="load, every 5s">
                    Loading resources usage...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-post="/srs/start" hx-target="#srs-status">Start</button>
                    <button class="btn-normal" hx-post="/srs/restart" hx-target="#srs-status">Restart</button>
                    <button class="btn-red" hx-post="/srs/kill" hx-target="#srs-status">Kill</button>
                </div>

                <div class="foldable-section">
                    <h3 class="foldable-title" onclick="toggleFoldable(this)">
                        <span class="icon">▼</span>
                        Manager settings
                    </h3>
                    <div class="foldable-content">
                        <div id="srs-manager-config" hx-get="/srs/manager_config_form" hx-trigger="load">
                            Loading config...
                        </div>
                        <div class="button-group">
                            <button class="btn-normal" hx-post="/srs/manager_config_form" hx-target="#srs-manager-config" hx-include="#srs-manager-config-form">
                                Save and apply
                            </button>
                            <button class="btn-normal" hx-get="/srs/manager_config_form" hx-target="#srs-manager-config">
                                Undo unsaved changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-content">
                <h2>SRS Server Configuration</h2>
                <div id="srs-config" hx-get="/srs/config_form" hx-trigger="load">
                    Loading config...
                </div>
                <div class="button-group">
                    <button class="btn-normal" hx-post="/srs/config_form" hx-target="#srs-config" hx-include="#srs-config-form">
                        Save
                    </button>
                    <button class="btn-normal" hx-post="/srs/config_form/restart" hx-target="#srs-config" hx-include="#srs-config-form">
                        Save and restart SRS Server
                    </button>
                    <button class="btn-normal" hx-get="/srs/config_form" hx-target="#srs-config">
                        Undo unsaved changes
                    </button>
                </div>
            </div>
        </div>
  
        <div class="section" id="logs-section">
            <div class="section-content">
                <h2>Logs</h2>
                <p>Size: <span id="log-size" hx-get="/logs/size" hx-trigger="load, every 60s">Loading size...</span></p>
                <pre id="logs" class="scroll-box logs-viewer">Click on "Refresh" to load logs</pre>
                <div class="button-group">
                    <button class="btn-normal" hx-get="/logs" hx-target="#logs">Refresh</button>
                    <button class="btn-red" hx-post="/logs/delete" hx-target="#logs">Delete Logs</button>
                </div>
            </div>
        </div>
    </div>
  
    <script>
        function showSection(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelector(`.nav-link[data-target="${id}"]`).classList.add('active');
        }
  
        document.addEventListener('DOMContentLoaded', () => {
            showSection('dcs-section');
        });

        function toggleFoldable(titleElement) {
            const content = titleElement.nextElementSibling;

            content.classList.toggle('open');
            titleElement.classList.toggle('open');
        }
    </script>
</body>
</html>
